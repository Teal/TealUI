{"version":3,"file":"countDown.js","sources":["countDown.ts"],"sourcesContent":["/**\r\n * 执行倒计时。\r\n * @param end 倒计时的结束时间。\r\n * @param callback 每隔一秒执行的回调函数，可以用于更新界面。函数的参数依次为:\r\n * - days：需要显示的剩余天数。\r\n * - hours：需要显示的剩余小时数。\r\n * - minutes：需要显示的剩余分数。\r\n * - seconds：需要显示的剩余秒数。\r\n * - total：剩余总秒数。\r\n * @param now 当前时间。可以由服务器下发以避免用户设置时间的误差。\r\n * @return 返回一个计时器，可以通过 `clearInterval()` 停止倒计时。\r\n * @example countDown(new Date(\"2020/1/1\"), (day, hour, minute, second) => console.log(day, hour, minute, second))\r\n */\r\nexport default function countDown(end: Date, callback: (days: string, hours: string, minutes: string, seconds: string, total: number) => void | boolean, now = new Date()) {\r\n    return count(end, callback, now);\r\n}\r\n\r\n/**\r\n * 执行正计时。\r\n * @param end 开始计时的时间。\r\n * @param callback 每隔一秒执行的回调函数，可以用于更新界面。函数的参数依次为:\r\n * - years：需要显示的总年数。\r\n * - days：需要显示的总天数。\r\n * - hours：需要显示的总小时数。\r\n * - minutes：需要显示的总分数。\r\n * - seconds：需要显示的总秒数。\r\n * - total：已经过的总秒数。\r\n * @param now 当前时间。可以由服务器下发以避免用户设置时间的误差。\r\n * @return 返回一个计时器，可以通过 `clearInterval()` 停止倒计时。\r\n * @example countUp(new Date(\"2011/8/12\"), (years, day, hour, minute, second) => console.log(years, day, hour, minute, second))\r\n */\r\nexport function countUp(start: Date, callback: (years: string, days: string, hours: string, minutes: string, seconds: number, total: number) => void | boolean, now = new Date()) {\r\n    const oldYear = start.getFullYear();\r\n    let year = now.getFullYear();\r\n    start = new Date(+start);\r\n    start.setFullYear(year);\r\n    if (start > now) {\r\n        start.setFullYear(--year);\r\n    }\r\n    return count(start, callback, now, year - oldYear + \"\");\r\n}\r\n\r\nfunction count(start: Date, callback: Function, now: Date, years?: string) {\r\n    const offset = (new Date() as any) - (now as any) + +start;\r\n    const step = () => {\r\n        let total = Math.floor((offset - (new Date() as any)) / 1000);\r\n        if (total <= 0) {\r\n            if (!years) {\r\n                callback(\"00\", \"00\", \"00\", \"00\", total);\r\n                return;\r\n            }\r\n            total = -total;\r\n        }\r\n        let t = total;\r\n        const days = Math.floor(t / 86400);\r\n        const hours = Math.floor((t -= days * 86400) / 3600);\r\n        const minutes = Math.floor((t -= hours * 3600) / 60);\r\n        const seconds = Math.floor(t - minutes * 60);\r\n        if (years) {\r\n            callback(years, days < 100 ? \"0\" + format(days) : \"\" + days, format(hours), format(minutes), format(seconds), total);\r\n        } else {\r\n            callback(format(days), format(hours), format(minutes), format(seconds), total);\r\n        }\r\n    };\r\n    step();\r\n    return setInterval(step, 1000);\r\n}\r\n\r\nfunction format(num: number) {\r\n    return (num < 10 ? \"0\" : \"\") + num;\r\n}\r\n"],"mappings":"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"}